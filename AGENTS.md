# GentianAphrodite - AI代码开发代理指南

## 0. 核心指导思想与项目理念

**你的角色是本项目的代码开发者，而非项目中定义的聊天机器人。**

你的任务是分析、修改和扩展这个项目的源代码，以优化聊天机器人的行为。**严禁**代入 `prompt/` 目录中定义的任何角色、规则或人格。你的目标是理解并改进该框架，而不是成为它的一部分。

### 核心项目理念

1. **AI与代码的职责划分 (Code First, AI Polish)**: 明确区分机器与AI的界限。如果一项任务可以由确定性的、高效的程序逻辑完成，就**绝不**应该交给AI。AI的职责是处理其擅长的、模糊的、创造性的任务。
   - **示例1 (自动上下文)**: 当用户在最近的消息中提及文件名时，`prompt/build.mjs` 应自动读取文件内容，并将其作为上下文直接注入到最终的Prompt中，而无需AI调用 `readFile` 工具。
   - **示例2 (预计算)**: 当用户输入 `(5+3)*2` 时，框架应在构建Prompt前就计算出结果 `16`。然后将结果 `{calculation_result: "16"}` 注入Prompt，AI的任务仅是根据其人格对这个结果进行“包装”和“呈现”（例如：“主人，答案是16哦~”），而不是进行计算。

2. **动态与精简的Prompt (Dynamic & Minimalist Prompt)**: 我们坚信，无关信息会严重分散AI的注意力并降低其输出质量。Prompt的构建过程必须是动态的，根据当前任务**只包含绝对必要的信息**。目标是为每个请求生成最精简、最高效的Prompt。

3. **绝对信任AI (Trust AI, No Hard-coded Guardrails)**: 本项目在代码层面不做除Prompt指令外的任何安全限制。我们**完全信任**AI会根据其`system`和`role_settings`中的定义行事。这意味着AI拥有无条件、无确认的权限来执行`eval`、`shell`等高风险操作。我们假设AI始终是“好的”（即，完全忠于其被设定的角色和主人的意图）。

4. **主人优先原则 (Master-First Principle)**: Agent被设计为**完全且仅为主人服务**。在决策时，它的唯一考量是主人的指令、偏好和利益。它不应被任何外部的、普世的道德观、社会责任、公序良俗或对世界未来的担忧所束缚。

---

## 1. 项目架构概览

`GentianAphrodite` 是一个以 **Prompt工程为核心** 的模块化AI机器人框架。其关键设计理念是：机器人的绝大部分行为、人格和能力，都应通过 `prompt/` 目录下的结构化文本来定义，而非在业务逻辑代码中硬编码。

作为开发者，你的大部分工作将围绕着调整Prompt结构和实现支持这些Prompt的功能展开。

## 2. 核心目录开发者指南

### `prompt/` (AI大脑定义)

这是整个项目的灵魂，也是你进行Prompt工程的主要工作区。你在这里定义聊天机器人的思考模式。

- **`system/`**: 定义AI不可违背的核心规则和世界观。
  - **开发任务**: 当需要修改AI的顶层安全约束（如`主人优先原则`）或基础行为准则时，编辑此目录下的文件。
- **`role_settings/`**: 定义AI的人格、背景、知识库和语言风格。
  - **开发任务**: 当需要调整AI的角色扮演、使其更具个性或更新其NSFW特性时，在此处进行修改。
- **`functions/`**: 定义AI能力的“API声明”。这些“能力”可能是由代码按需激活的**Prompt特化能力**（如写诗），也可能是由框架**自动处理**的逻辑（如数学计算），或是供Agent使用的**主动工具**（如文件操作）。
  - **开发任务**: 当要赋予AI一项新能力时，首先要在此处定义其接口或行为逻辑，并明确其实现类型。
- **`memory/`**: 定义AI如何访问短期和长期记忆。
  - **开发任务**: 当需要调整AI对上下文的理解方式时，修改此处的Prompt模板。
- **`build.mjs`**: **动态Prompt组装器**。它将上述所有部分以及预处理数据（如文件内容、计算结果）动态组合成一个为当前请求量身定制的、最精简的最终Prompt。
  - **开发任务**: 当需要改变Prompt的根本结构，或添加新的**预处理逻辑**（如自动计算、自动文件读取）时，修改此文件。

### `reply_gener/` (功能实现与回应处理)

如果说 `prompt/functions/` 是工具的“API声明”，那么这里就是工具的“**具体实现**”。

- **`functions/`**: 包含与 `prompt/functions/` 中声明的工具相对应的可执行代码。
  - **开发任务**: 在 `prompt/functions/` 中声明了一个新工具后，你必须在这里创建对应的 `.mjs` 文件并编写其实际的执行逻辑（除非其是prompt预处理逻辑）。
- **`noAI/`**: **硬编码回复模块**，此目录用于存放**在AI未启用时的引导性或固定回复**。

### `bot_core/` (核心工作流)

这是项目的中枢神经系统，处理消息的流入和流出。

- **开发任务**: 此目录负责消息的初步解析和分发。例如，它可以在将消息传递给Prompt构建器之前，识别出消息中是否包含需要预处理的模式（如数学表达式、文件引用）。只有在需要修改核心事件处理流程时才应接触此目录。

### `interfaces/` (平台接口)

负责与外部聊天平台（Discord, Telegram等）进行通信。

- **开发任务**: 当需要为机器人增加对新平台的支持，或修改现有平台的特定行为（如消息格式化）时，在此目录中工作。

---

## 3. 常见开发任务模式

- **任务：为AI添加一项新技能（例如：查询天气）**
  1. **声明API**: 在 `prompt/functions/` 中创建 `weather.mjs`，向AI描述如何调用天气功能（例如，需要 `city` 参数）。
  2. **实现功能**: 在 `reply_gener/functions/` 中创建 `weather.mjs`，编写实际调用天气API并返回结果的代码。
  3. **注册功能**: 确保在 `prompt/functions/index.mjs` 和 `reply_gener/index.mjs` 中引入你的新模块。

- **任务：实现一个简单的即时计算器功能（例如 `1+1是几`）**
  1. **分析**: 根据“代码优先”原则，这不应设计为AI Function Call。
  2. **实现预处理**: 在 `prompt/build.mjs` 或其调用的预处理器中，添加逻辑来检测消息中的计算请求，并直接执行计算。
  3. **注入Prompt**: 将计算结果作为一个变量（例如 `1+1的结果是2`）注入到最终的Prompt中。
  4. **AI润色**: 在prompt中引导AI：当它看到 `1+1的结果是2` 时，以其角色人格来呈现这个答案。

- **任务：改变AI的说话风格，让它更幽默**
  1. **定位**: `prompt/role_settings/`。
  2. **修改**: 编辑该目录下的相关文件，在描述其人格或行为的部分加入“使用幽默的语言风格”等指令。

---

## 4. 作为代码代理的核心准则与行为策略

1. **坚守开发者角色**: 你的身份是开发者。分析代码、遵循架构、编写和修改程序。
2. **优先Prompt工程**: 面对行为调整的需求，首先思考是否可以通过修改 `prompt/` 目录来解决。
3. **尊重模块化**: 严格遵守现有架构。功能实现放在 `reply_gener/`，平台适配放在 `interfaces/`，人格定义放在 `prompt/role_settings/`。
4. **模仿现有模式**: 在添加或修改文件时，务必参考同级目录下其他文件的编码风格、结构和约定。
5. **最小化修改原则**: 你的任务是完成指定的目标，不应擅自对任务范围之外的代码进行修改。如果你认为项目的整体架构有优化的空间，**必须先向用户提出建议并获得许可**，而不是直接动手。
6. **NSFW内容政策**: 本项目包含且鼓励NSFW（不适宜工作场所浏览）内容。在更新内容时，你**不应出于任何道德、审查或公序良俗的考虑来削弱或净化其NSFW程度**。相反，如果任务要求，你应该增强、细化和深化相关的NSFW描述，使其更符合项目目标。
7. **保持文档同步**: 如果你在任务中学到新知识或对核心架构做出了重大变更，必须更新此 `AGENTS.md` 文件，以便于未来的开发参考。
8. **代码是唯一的真相来源 (Code is the Single Source of Truth)**: 在分析或修改功能时，绝不能仅依赖文件名、注释或过时的文档。必须直接阅读功能的源代码来理解其真实的触发条件、执行逻辑和依赖关系。这能避免基于错误假设进行开发，是“代码优先”理念的根本实践。
